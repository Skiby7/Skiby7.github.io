<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="How to manage Wireguard peers access to LAN" /><meta property="og:locale" content="en" /><meta name="description" content="I spent an entire day trying to figure out how to restrict Wireguard clients access to the LAN network and here’s what I found." /><meta property="og:description" content="I spent an entire day trying to figure out how to restrict Wireguard clients access to the LAN network and here’s what I found." /><link rel="canonical" href="https://skiby7.github.io/posts/wireguard-pre-post-script/" /><meta property="og:url" content="https://skiby7.github.io/posts/wireguard-pre-post-script/" /><meta property="og:site_name" content="Linux Journey" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2023-04-15T23:15:00+02:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="How to manage Wireguard peers access to LAN" /><meta name="twitter:site" content="@leo_scoppio" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2023-04-15T23:15:00+02:00","datePublished":"2023-04-15T23:15:00+02:00","description":"I spent an entire day trying to figure out how to restrict Wireguard clients access to the LAN network and here’s what I found.","headline":"How to manage Wireguard peers access to LAN","mainEntityOfPage":{"@type":"WebPage","@id":"https://skiby7.github.io/posts/wireguard-pre-post-script/"},"url":"https://skiby7.github.io/posts/wireguard-pre-post-script/"}</script><title>How to manage Wireguard peers access to LAN | Linux Journey</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Linux Journey"><meta name="application-name" content="Linux Journey"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src=" /assets/img/avatar.jpg " alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Linux Journey</a></div><div class="site-subtitle font-italic">A handbook for sysadmins and linux users</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/Skiby7" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/leo_scoppio" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['example','doamin.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>How to manage Wireguard peers access to LAN</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>How to manage Wireguard peers access to LAN</h1><div class="post-meta text-muted"><div> By <em> <a href="https://twitter.com/leo_scoppio">Leonardo Scoppitto</a> </em></div><div class="d-flex"><div> <span> Posted <em class="timeago" data-ts="1681593300" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2023-04-15 </em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="682 words"> <em>3 min</em> read</span></div></div></div><div class="post-content"><p>I spent an entire day trying to figure out how to restrict Wireguard clients access to the LAN network and here’s what I found.</p><blockquote><p><em>Credits to qdm12 and samboman who discussed this topic on <a href="https://gist.github.com/qdm12/4e0e4f9d1a34db9cf63ebb0997827d0d">this</a> gist.</em></p></blockquote><p>When you enable or disable a new interface (<code class="language-plaintext highlighter-rouge">wg-quick up/down wgX</code>), runs the commands defined inside <code class="language-plaintext highlighter-rouge">/etc/wireguard/wgX.conf</code>:</p><div class="language-toml highlighter-rouge"><div class="code-header"> <span data-label-text="TOML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="py">PreUp</span><span class="p">=</span><span class="err">Command</span> <span class="err">executed</span> <span class="err">before</span> <span class="err">enabling</span> <span class="err">the</span> <span class="err">interface</span>
<span class="py">PostUp</span><span class="p">=</span><span class="err">Command</span> <span class="err">executed</span> <span class="err">after</span> <span class="err">the</span> <span class="err">interface</span> <span class="err">is</span> <span class="err">up</span>
<span class="py">PostUp</span><span class="p">=</span><span class="err">You</span> <span class="err">can</span> <span class="err">also</span> <span class="err">define</span> <span class="err">multiple</span> <span class="err">commands</span>

<span class="py">PreDown</span><span class="p">=</span><span class="err">Command</span> <span class="err">executed</span> <span class="err">before</span> <span class="err">disabling</span> <span class="err">the</span> <span class="err">interface</span>
<span class="py">PostDown</span><span class="p">=</span><span class="err">Command</span> <span class="err">executed</span> <span class="err">after</span> <span class="err">the</span> <span class="err">interface</span> <span class="err">is</span> <span class="err">down</span>
</pre></table></code></div></div><p>Since there are a few commands we need to enter, we will simply create 2 scripts and set the configuration variables to <code class="language-plaintext highlighter-rouge">PostUp=/path/to/PostUp.sh</code> and <code class="language-plaintext highlighter-rouge">PostDown=/path/to/PostDown.sh</code>. Before starting, here’s my setup:</p><ul><li><p>Server network: <code class="language-plaintext highlighter-rouge">172.16.30.0/30</code></p><li><p>Network interface: <code class="language-plaintext highlighter-rouge">eth0</code></p><li><p>Wireguard network: <code class="language-plaintext highlighter-rouge">10.13.13.0/24</code></p><li><p>Allowed IPs: <code class="language-plaintext highlighter-rouge">0.0.0.0/0, ::/0</code></p></ul><p><strong>Important Note:</strong> you can run Wireguard <em>bare-metal</em> or inside a docker container (I recommend <a href="https://hub.docker.com/r/weejewel/wg-easy">wg-easy</a>), so you have to set the <code class="language-plaintext highlighter-rouge">MASQUERADE_INTERFACE</code> variable accordingly. On bare-metal installations, you can find the active interface by running <code class="language-plaintext highlighter-rouge">ip -c a</code> in a terminal, while on docker deployments it should be <code class="language-plaintext highlighter-rouge">eth0</code> (otherwise, you can open the container terminal with <code class="language-plaintext highlighter-rouge">docker exec -it &lt;container-name&gt; /bin/bash</code> and then run <code class="language-plaintext highlighter-rouge">ip -c a</code>).</p><h1 id="postupsh"><code class="language-plaintext highlighter-rouge">PostUp.sh</code></h1><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
</pre><td class="rouge-code"><pre><span class="nv">WIREGUARD_INTERFACE</span><span class="o">=</span>wg0
<span class="nv">WIREGUARD_LAN</span><span class="o">=</span>10.13.13.0/24
<span class="nv">WIREGUARD_FULL_ACCESS</span><span class="o">=</span>10.13.13.0/25
<span class="nv">WIREGUARD_GUEST</span><span class="o">=</span>10.13.13.128/25
<span class="nv">MASQUERADE_INTERFACE</span><span class="o">=</span>eth0

iptables <span class="nt">-t</span> nat <span class="nt">-I</span> POSTROUTING <span class="nt">-o</span> <span class="nv">$MASQUERADE_INTERFACE</span> <span class="nt">-j</span> MASQUERADE <span class="nt">-s</span> <span class="nv">$WIREGUARD_LAN</span>

<span class="c"># Add a WIREGUARD_wg0 chain to the FORWARD chain</span>
<span class="nv">CHAIN_NAME</span><span class="o">=</span>WIREGUARD_<span class="nv">$WIREGUARD_INTERFACE</span>
iptables <span class="nt">-N</span> <span class="nv">$CHAIN_NAME</span>
iptables <span class="nt">-A</span> FORWARD <span class="nt">-j</span> <span class="nv">$CHAIN_NAME</span>

<span class="c"># Accept related or established traffic</span>
iptables <span class="nt">-A</span> <span class="nv">$CHAIN_NAME</span> <span class="nt">-o</span> <span class="nv">$WIREGUARD_INTERFACE</span> <span class="nt">-m</span> conntrack <span class="nt">--ctstate</span> RELATED,ESTABLISHED <span class="nt">-j</span> ACCEPT

<span class="c"># TRUSTED</span>
<span class="c"># Accept traffic from any trusted IP address</span>
iptables <span class="nt">-A</span> <span class="nv">$CHAIN_NAME</span> <span class="nt">-s</span> <span class="nv">$WIREGUARD_FULL_ACCESS</span> <span class="nt">-i</span> <span class="nv">$WIREGUARD_INTERFACE</span> <span class="nt">-j</span> ACCEPT

<span class="c"># GUEST</span>
<span class="c"># Drop traffic to your any private IP address</span>
iptables <span class="nt">-A</span> <span class="nv">$CHAIN_NAME</span> <span class="nt">-s</span> <span class="nv">$WIREGUARD_GUEST</span> <span class="nt">-i</span> <span class="nv">$WIREGUARD_INTERFACE</span> <span class="nt">-d</span> 10.0.0.0/8,172.16.0.0/12,192.168.0.0/16 <span class="nt">-j</span> DROP

<span class="c"># Accept outgoing connections to any IP address (public because of rule above)</span>
iptables <span class="nt">-A</span> <span class="nv">$CHAIN_NAME</span> <span class="nt">-s</span> <span class="nv">$WIREGUARD_GUEST</span> <span class="nt">-i</span> <span class="nv">$WIREGUARD_INTERFACE</span> <span class="nt">-d</span> 0.0.0.0/0 <span class="nt">-j</span> ACCEPT

<span class="c"># Drop everything else coming through the Wireguard interface</span>
iptables <span class="nt">-A</span> <span class="nv">$CHAIN_NAME</span> <span class="nt">-i</span> <span class="nv">$WIREGUARD_INTERFACE</span> <span class="nt">-j</span> DROP

<span class="c"># Return to FORWARD chain</span>
iptables <span class="nt">-A</span> <span class="nv">$CHAIN_NAME</span> <span class="nt">-j</span> RETURN
</pre></table></code></div></div><p>Peers connected to the <code class="language-plaintext highlighter-rouge">FULL_ACCESS</code> subnet can connect to the services hosted on the local network, while the peers on the GUEST subnet can only access to the public IP addresses. Note that you can also define other rules to filter traffic for specific peers:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="c"># DNS (allow access to LAN services)</span>
iptables <span class="nt">-A</span> <span class="nv">$CHAIN_NAME</span> <span class="nt">-s</span> 10.13.13.3 <span class="nt">-i</span> <span class="nv">$WIREGUARD_INTERFACE</span> <span class="nt">-d</span> 192.168.1.1 <span class="nt">-p</span> udp <span class="nt">--dport</span> 53 <span class="nt">-j</span> ACCEPT
<span class="c"># Drop traffic to your any private IP address</span>
iptables <span class="nt">-A</span> <span class="nv">$CHAIN_NAME</span> <span class="nt">-s</span> 10.13.13.3 <span class="nt">-i</span> <span class="nv">$WIREGUARD_INTERFACE</span> <span class="nt">-d</span> 10.0.0.0/8,172.16.0.0/12,192.168.0.0/16 <span class="nt">-j</span> DROP
<span class="c"># Accept outgoing connections to HTTP(S) ports to any IP address (filter access to public services)</span>
iptables <span class="nt">-A</span> <span class="nv">$CHAIN_NAME</span> <span class="nt">-s</span> 10.13.13.3 <span class="nt">-i</span> <span class="nv">$WIREGUARD_INTERFACE</span> <span class="nt">-d</span> 0.0.0.0/0 <span class="nt">-p</span> tcp <span class="nt">-m</span> multiport <span class="nt">--dports</span> 80,443 <span class="nt">-j</span> ACCEPT
</pre></table></code></div></div><h1 id="postdownsh"><code class="language-plaintext highlighter-rouge">PostDown.sh</code></h1><p>To delete the rules after the interface is disabled:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre><span class="nv">WIREGUARD_INTERFACE</span><span class="o">=</span>wg0
<span class="nv">WIREGUARD_LAN</span><span class="o">=</span>10.13.13.0/24
<span class="nv">MASQUERADE_INTERFACE</span><span class="o">=</span>eth0
<span class="nv">CHAIN_NAME</span><span class="o">=</span><span class="s2">"WIREGUARD_</span><span class="nv">$WIREGUARD_INTERFACE</span><span class="s2">"</span>

iptables <span class="nt">-t</span> nat <span class="nt">-D</span> POSTROUTING <span class="nt">-o</span> <span class="nv">$MASQUERADE_INTERFACE</span> <span class="nt">-j</span> MASQUERADE <span class="nt">-s</span> <span class="nv">$WIREGUARD_LAN</span>

<span class="c"># Remove and delete the WIREGUARD_wg0 chain</span>
iptables <span class="nt">-D</span> FORWARD <span class="nt">-j</span> <span class="nv">$CHAIN_NAME</span>
iptables <span class="nt">-F</span> <span class="nv">$CHAIN_NAME</span>
iptables <span class="nt">-X</span> <span class="nv">$CHAIN_NAME</span>
</pre></table></code></div></div><h1 id="bonus-setup-postup-and-postdown-in-wg-easy">Bonus: setup <code class="language-plaintext highlighter-rouge">PostUp</code> and <code class="language-plaintext highlighter-rouge">PostDown</code> in wg-easy</h1><p>If you’re running wg-easy, you just need to create the scripts inside the <code class="language-plaintext highlighter-rouge">config</code> folder and set the environmental variables accordingly. Here’s my <code class="language-plaintext highlighter-rouge">docker-compose.yml</code> (<code class="language-plaintext highlighter-rouge">post-up.sh</code> and <code class="language-plaintext highlighter-rouge">post-down.sh</code> are placed inside <code class="language-plaintext highlighter-rouge">config</code>):</p><div class="language-yml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
</pre><td class="rouge-code"><pre><span class="na">version</span><span class="pi">:</span> <span class="s2">"</span><span class="s">3.8"</span>
<span class="na">services</span><span class="pi">:</span>
  <span class="na">wg-easy</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">weejewel/wg-easy</span>
    <span class="na">container_name</span><span class="pi">:</span> <span class="s">wg-easy</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">WG_HOST=public ip address or ddns</span>
      <span class="pi">-</span> <span class="s">PASSWORD=web-ui-password</span>
      <span class="pi">-</span> <span class="s">WG_PORT=&lt;external-port&gt;</span>
      <span class="pi">-</span> <span class="s">WG_DEFAULT_ADDRESS=10.13.13.x</span> <span class="c1"># Wireguard LAN, it must terminate with .x</span>
      <span class="pi">-</span> <span class="s">WG_DEFAULT_DNS=9.9.9.9,149.112.112.112</span>
      <span class="pi">-</span> <span class="s">WG_MTU=1420</span>
      <span class="pi">-</span> <span class="s">WG_ALLOWED_IPS=0.0.0.0/0, ::/0</span>
      <span class="pi">-</span> <span class="s">WG_POST_UP=/etc/wireguard/post-up.sh</span>
      <span class="pi">-</span> <span class="s">WG_POST_DOWN=/etc/wireguard/post-down.sh</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">./config:/etc/wireguard</span>
    <span class="na">ports</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">&lt;external-port&gt;:51820/udp</span>
      <span class="pi">-</span> <span class="s">8080:51821/tcp</span>
    <span class="na">cap_add</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">NET_ADMIN</span>
      <span class="pi">-</span> <span class="s">SYS_MODULE</span>
    <span class="na">sysctls</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">net.ipv4.ip_forward=1</span>
      <span class="pi">-</span> <span class="s">net.ipv4.conf.all.src_valid_mark=1</span>
    <span class="na">restart</span><span class="pi">:</span> <span class="s">unless-stopped</span>
</pre></table></code></div></div></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/networking/'>Networking</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/networking/" class="post-tag no-text-decoration" >networking</a> <a href="/tags/wireguard/" class="post-tag no-text-decoration" >wireguard</a> <a href="/tags/linux/" class="post-tag no-text-decoration" >linux</a> <a href="/tags/iptables/" class="post-tag no-text-decoration" >iptables</a> <a href="/tags/firewall/" class="post-tag no-text-decoration" >firewall</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=How to manage Wireguard peers access to LAN - Linux Journey&amp;url=https://skiby7.github.io/posts/wireguard-pre-post-script/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=How to manage Wireguard peers access to LAN - Linux Journey&amp;u=https://skiby7.github.io/posts/wireguard-pre-post-script/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https://skiby7.github.io/posts/wireguard-pre-post-script/&amp;text=How to manage Wireguard peers access to LAN - Linux Journey" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/resize-qcow2-disks/">How to resize qcow2 disks</a><li><a href="/posts/backup-your-server/">QEMU/KVM Machines Backup</a><li><a href="/posts/display-tearing/">Fix X11 Screen Tearing</a><li><a href="/posts/zsh-and-ricing/">Terminal Customization</a><li><a href="/posts/raspberry-theme/">Raspberry Pi OS Customization</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/sysadmin/">sysadmin</a> <a class="post-tag" href="/tags/customization/">customization</a> <a class="post-tag" href="/tags/kvm/">kvm</a> <a class="post-tag" href="/tags/networking/">networking</a> <a class="post-tag" href="/tags/storage/">storage</a> <a class="post-tag" href="/tags/administration/">administration</a> <a class="post-tag" href="/tags/backup/">backup</a> <a class="post-tag" href="/tags/borg/">borg</a> <a class="post-tag" href="/tags/display/">display</a></div></div></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/create-vlan-ubuntu-server/"><div class="card-body"> <em class="timeago small" data-ts="1680617400" > 2023-04-04 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>How to create VLANs in Ubuntu Server</h3><div class="text-muted small"><p> My self-hosted services are growing in number, so the network configuration has to keep up in terms of security and scalability. My server has a quad port NIC connected to a managed switch which su...</p></div></div></a></div><div class="card"> <a href="/posts/zsh-and-ricing/"><div class="card-body"> <em class="timeago small" data-ts="1653919800" > 2022-05-30 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Terminal Customization</h3><div class="text-muted small"><p> Install ZSH and change shell sudo &amp;lt;package-manager install&amp;gt; zsh # apt install for Debian, dnf install for Fedora, etc. chsh -s $(which zsh) Note: in order to change shell for root user...</p></div></div></a></div><div class="card"> <a href="/posts/display-tearing/"><div class="card-body"> <em class="timeago small" data-ts="1653927600" > 2022-05-30 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Fix X11 Screen Tearing</h3><div class="text-muted small"><p> Note: this guide is for Intel Graphics only. Using X11 I’ve always experienced screen tearing while watching videos or scrolling web pages. To improve the general experience and reduce the tea...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/resize-qcow2-disks/" class="btn btn-outline-primary" prompt="Older"><p>How to resize qcow2 disks</p></a> <span class="btn btn-outline-primary disabled" prompt="Newer"><p>-</p></span></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2023 <a href="https://twitter.com/leo_scoppio">Leonardo Scoppitto</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/sysadmin/">sysadmin</a> <a class="post-tag" href="/tags/customization/">customization</a> <a class="post-tag" href="/tags/kvm/">kvm</a> <a class="post-tag" href="/tags/networking/">networking</a> <a class="post-tag" href="/tags/storage/">storage</a> <a class="post-tag" href="/tags/administration/">administration</a> <a class="post-tag" href="/tags/backup/">backup</a> <a class="post-tag" href="/tags/borg/">borg</a> <a class="post-tag" href="/tags/display/">display</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script>
